namespace = me_subject_independence

## Mission 1 - Internal discussion of independence - start
me_subject_independence.1 = {
    type = country_event
    title = me_subject_independence.1.t
    desc = me_subject_independence.1.desc
    picture = senate_debate	# TODO adjust for different governments and cultures
    left_portrait = scope:random_left_advisor
	right_portrait = scope:random_right_advisor

    option = {      
        name = me_subject_independence.1.a
		custom_tooltip = me_subject_independence.1.at
    }
}

me_subject_independence.2 = {	# Discussion which path should be taken
	type = country_event
	hidden = yes

	immediate = {
		if = {	# Discussion continues
			limit = {
				var:discussion_progress < 5
				is_subject = yes
			}
			random_list = {
				1 = {	# Complication event - Left side forces their argument
					trigger = {
						NOT = {
							has_variable = left_forced
						}
					}
					scope:random_left_advisor = {
						save_scope_as = selected_advisor
					}
					set_variable = {
						name = left_check
						days = 15
					}
					set_variable = {
						name = left_forced
						days = 60
					}
					change_variable = {
						name = left_argument_points
						add = 1
					}
					trigger_event = {
						id = me_subject_independence.3
					}
				}
				1 = {	# Complication event - Right side forces their argument
					trigger = {
						NOT = {
							has_variable = right_forced
						}
					}
					scope:random_right_advisor = {
						save_scope_as = selected_advisor
					}
					set_variable = {
						name = right_check
						days = 15
					}
					set_variable = {
						name = right_forced
						days = 40
					}
					change_variable = {
						name = right_argument_points
						add = 1
					}
					trigger_event = {
						id = me_subject_independence.3
					}
				}
				2 = {	# Complication event - Left side objects
					scope:random_left_advisor = {
						save_scope_as = selected_advisor
					}
					set_variable = {
						name = left_check
						days = 15
					}
					trigger_event = {
						id = me_subject_independence.4
					}
				}
				2 = {	# Complication event - Right side objects
					scope:random_right_advisor = {
						save_scope_as = selected_advisor
					}
					set_variable = {
						name = right_check
						days = 15
					}
					trigger_event = {
						id = me_subject_independence.4
					}
				}
				2 = {	# Complication event - Left side bribes
					trigger = {
						NOT = {
							has_variable = left_bribed
						}
					}
					scope:random_left_advisor = {
						save_scope_as = selected_advisor
					}
					set_variable = {
						name = left_check
						days = 15
					}
					set_variable = {
						name = left_bribed
						days = 60
					}
					trigger_event = {
						id = me_subject_independence.5
					}
				}
				2 = {	# Complication event - Right side bribes
					trigger = {
						NOT = {
							has_variable = right_bribed
						}
					}
					scope:random_right_advisor = {
						save_scope_as = selected_advisor
					}
					set_variable = {
						name = right_check
						days = 15
					}
					set_variable = {
						name = right_bribed
						days = 60
					}
					trigger_event = {
						id = me_subject_independence.5
					}
				}
				2 = {	# Complication event - Left side brilliant speech
					trigger = {
						NOT = {
							has_variable = left_speeched
						}
					}
					scope:random_left_advisor = {
						save_scope_as = selected_advisor
					}
					set_variable = {
						name = left_check
						days = 15
					}
					set_variable = {
						name = left_speeched
						days = 60
					}
					trigger_event = {
						id = me_subject_independence.6
					}
				}
				2 = {	# Complication event - Right side brilliant speech
					trigger = {
						NOT = {
							has_variable = right_speeched
						}
					}
					scope:random_right_advisor = {
						save_scope_as = selected_advisor
					}
					set_variable = {
						name = right_check
						days = 15
					}
					set_variable = {
						name = right_speeched
						days = 60
					}
					trigger_event = {
						id = me_subject_independence.6
					}
				}
				1 = {	# Complication event - Left side makes promises
					trigger = {
						NOT = {
							has_variable = left_promised
						}
					}
					scope:random_left_advisor = {
						save_scope_as = selected_advisor
					}
					set_variable = {
						name = left_check
						days = 15
					}
					set_variable = {
						name = left_promised
						days = 60
					}
					change_variable = {
						name = left_argument_points
						add = 1
					}
					trigger_event = {
						id = me_subject_independence.7
					}
				}
				1 = {	# Complication event - Right side makes promises
					trigger = {
						NOT = {
							has_variable = right_promised
						}
					}
					scope:random_right_advisor = {
						save_scope_as = selected_advisor
					}
					set_variable = {
						name = right_check
						days = 15
					}
					set_variable = {
						name = right_promised
						days = 60
					}
					change_variable = {
						name = right_argument_points
						add = 1
					}
					trigger_event = {
						id = me_subject_independence.7
					}
				}
			}
			change_variable = {
				name = discussion_progress
				add = 1
			}
			trigger_event = {
				id = me_subject_independence.2
				days = { 25 30 }
			}
		}
		else_if = {	# Discussion finished
			limit = {
				var:discussion_progress >= 5
				is_subject = yes
			}
			if = {	# Left side superior
				limit = {
					var:left_argument_points > var:right_argument_points
				}
				set_variable = {
					name = left_won
				}
			}
			else_if = {	# Right side superior
				limit = {
					var:left_argument_points < var:right_argument_points
				}
				set_variable = {
					name = right_won
				}
			}
			else = {	# Stalemate
				set_variable = {
					name = stalemate_won
				}
			}
			hidden_effect = {
				remove_variable = discussion_progress
				remove_variable = left_argument_points
				remove_variable = right_argument_points
			}
		}
		else = {	# Fallback cleanup
			hidden_effect = {
				remove_variable = discussion_progress
				remove_variable = left_argument_points
				remove_variable = right_argument_points
			}
		}
	}
}

me_subject_independence.3 = {	# Discussion event - A side forces their argument
	type = country_event
	title = me_subject_independence.3.t
    desc = me_subject_independence.3.desc	# TODO add differences to which side is forcing their argument
    picture = senate_debate	# TODO adjust for different governments and cultures
    left_portrait = current_ruler
	right_portrait = scope:selected_advisor
	
	option = {
		name = me_subject_independence.3.a
		if = {
			limit = {
				has_variable = left_check
			}
			custom_tooltip = me_subject_independence.3.at_l
		}
		else = {
			custom_tooltip = me_subject_independence.3.at_r
		}
	}
}

me_subject_independence.4 = {	# Discussion event - A side objects
	type = country_event
	title = me_subject_independence.4.t
    desc = me_subject_independence.4.desc	# TODO add differences to which side is forcing their argument
    picture = senate_debate	# TODO adjust for different governments and cultures
    left_portrait = current_ruler
	right_portrait = scope:selected_advisor

	option = {	# Agree with the objecting side
		name = me_subject_independence.4.a
		if = {
			limit = {
				has_variable = left_check
			}
			custom_tooltip = me_subject_independence.4.at_l
			hidden_effect = {
				change_variable = {
					name = left_argument_points
					add = 1
				}
			}
		}
		else = {
			custom_tooltip = me_subject_independence.4.at_r
			hidden_effect = {
				change_variable = {
					name = right_argument_points
					add = 1
				}
			}
		}
		scope:selected_advisor = {
			add_loyalty = advisor_agree_pos_loyalty
		}
	}

	option = {	# Disagree with the objecting side
		name = me_subject_independence.4.b
		if = {
			limit = {
				has_variable = left_check
			}
			custom_tooltip = me_subject_independence.4.bt_l
			hidden_effect = {
				change_variable = {
					name = right_argument_points
					add = 1
				}
			}
		}
		else = {
			custom_tooltip = me_subject_independence.4.bt_r
			hidden_effect = {
				change_variable = {
					name = left_argument_points
					add = 1
				}
			}
		}
		scope:selected_advisor = {
			add_loyalty = advisor_deny_neg_loyalty
		}
	}
}

me_subject_independence.5 = {	# Discussion event - A side attempts a bribe
	type = country_event
	title = me_subject_independence.5.t
    desc = me_subject_independence.5.desc	# TODO add differences to which side is forcing their argument
    picture = senate_debate	# TODO adjust for different governments and cultures
    left_portrait = current_ruler
	right_portrait = scope:selected_advisor

	option = {	# Take the bribe
		name = me_subject_independence.5.a
		if = {
			limit = {
				has_variable = left_check
			}
			custom_tooltip = me_subject_independence.5.at_l
			hidden_effect = {
				change_variable = {
					name = left_argument_points
					add = 1
				}
			}
		}
		else = {
			custom_tooltip = me_subject_independence.5.at_r
			hidden_effect = {
				change_variable = {
					name = right_argument_points
					add = 1
				}
			}
		}
		scope:selected_advisor = {
			add_gold = -200
			add_loyalty = advisor_agree_pos_loyalty
		}
		current_ruler = {
			add_gold = 200
			add_popularity = subtract_popularity_large
			add_corruption = corruption_large
		}
	}

	option = {	# Don't take the bribe
		name = me_subject_independence.5.b
		custom_tooltip = me_subject_independence.5.bt
		scope:selected_advisor = {
			add_loyalty = advisor_deny_neg_loyalty
			add_popularity = subtract_popularity_large
		}
		current_ruler = {
			add_popularity = popularity_large
		}
	}
}

me_subject_independence.6 = {	# Discussion event - A side makes a brilliant speech
	type = country_event
	title = me_subject_independence.6.t
    desc = me_subject_independence.6.desc	# TODO add differences to which side is forcing their argument
    picture = senate_debate	# TODO adjust for different governments and cultures
    left_portrait = current_ruler
	right_portrait = scope:selected_advisor

	option = {	# Join in with popular opinion
		name = me_subject_independence.6.a
		if = {
			limit = {
				has_variable = left_check
			}
			custom_tooltip = me_subject_independence.6.at_l
			hidden_effect = {
				change_variable = {
					name = left_argument_points
					add = 1
				}
			}
		}
		else = {
			custom_tooltip = me_subject_independence.6.at_r
			hidden_effect = {
				change_variable = {
					name = right_argument_points
					add = 1
				}
			}
		}
		scope:selected_advisor = {
			add_loyalty = advisor_agree_pos_loyalty
		}
	}

	option = {	# Poke holes in flawed argument
		name = me_subject_independence.6.b
		if = {
			limit = {
				has_variable = left_check
			}
			custom_tooltip = me_subject_independence.6.bt_l
			hidden_effect = {
				change_variable = {
					name = right_argument_points
					add = 1
				}
			}
		}
		else = {
			custom_tooltip = me_subject_independence.6.bt_r
			hidden_effect = {
				change_variable = {
					name = left_argument_points
					add = 1
				}
			}
		}
		scope:selected_advisor = {
			add_loyalty = advisor_deny_neg_loyalty
		}
		current_ruler = {
			add_popularity = subtract_popularity_large
		}
	}
}

me_subject_independence.7 = {	# Discussion event - A side makes beautiful promises
	type = country_event
	title = me_subject_independence.7.t
    desc = me_subject_independence.7.desc	# TODO add differences to which side is forcing their argument
    picture = senate_debate	# TODO adjust for different governments and cultures
    left_portrait = current_ruler
	right_portrait = scope:selected_advisor

	option = {
		name = me_subject_independence.7.a
		if = {
			limit = {
				has_variable = left_check
			}
			custom_tooltip = me_subject_independence.7.at_l
		}
		else = {
			custom_tooltip = me_subject_independence.7.at_r
		}
	}
}

me_subject_independence.10 = {	# Resolution event - Left side wins
	type = country_event
	title = me_subject_independence.10.t
	desc = me_subject_independence.10.desc
	picture = senate_debate	# TODO adjust for different governments and cultures
	left_portrait = current_ruler
	right_portrait = scope:random_left_advisor

	option = {
		name = me_subject_independence.10.a
		custom_tooltip = me_subject_independence.10.at
	}
}

me_subject_independence.11 = {	# Resolution event - Right side wins
	type = country_event
	title = me_subject_independence.11.t
	desc = me_subject_independence.11.desc
	picture = senate_debate	# TODO adjust for different governments and cultures
	left_portrait = current_ruler
	right_portrait = scope:random_right_advisor

	option = {
		name = me_subject_independence.11.a
		custom_tooltip = me_subject_independence.11.at
	}
}

me_subject_independence.12 = {	# Resolution event - Stalemate
	type = country_event
	title = me_subject_independence.12.t
	desc = me_subject_independence.12.desc
	picture = senate_debate	# TODO adjust for different governments and cultures
	left_portrait = scope:random_left_advisor
	right_portrait = scope:random_right_advisor

	option = {
		name = me_subject_independence.12.a
		custom_tooltip = me_subject_independence.12.at
	}
}
## Mission 1 - Internal discussion of independence - end

## Mission 5 (Left) - Preparing Character - start
me_subject_independence.15 = {
	type = country_event
	title = me_subject_independence.15.t
	desc = me_subject_independence.15.desc
	picture = senate_debate	# TODO adjust for different governments and cultures
	left_portrait = current_ruler

	option = {
		name = me_subject_independence.15.a
		custom_tooltip = me_subject_independence.15.at
	}
}

me_subject_independence.16 = {	# Choice of Price maintenance event
	type = country_event
	hidden = yes

	immediate = {
		if = {
			limit = {
				AND = {
					var:fh_progress < 3
					list_size = {
						name = family_heads_list
						value > 0
					}
				}
			}
			random_in_list = {
				list = family_heads_list
				save_scope_as = selected_family_head
				remove_from_list = family_heads_list
			}
			random_list = {
				2 = {	# Asking for a bribe
					trigger_event = {
						id = me_subject_independence.17
					}
				}
				2 = {	# Asking for holdings
					trigger = {
						total_holdings >= 5
					}
					trigger_event = {
						id = me_subject_independence.18
					}
				}
				2 = {	# Asking for minor advisory roles
					trigger_event = {
						id = me_subject_independence.19
					}
				}
				1 = {	# Asking for nothing
					trigger_event = {
						id = me_subject_independence.20
					}
				}
			}
			trigger_event = {
				id = me_subject_independence.16
				days = 15
			}
			change_variable = {
				name = fh_progress
				add = 1
			}
		}
		else = {	# Cleanup
			remove_variable = fh_progress
		}
	}
}

me_subject_independence.17 = {	# Choice Event - FH asks for a bribe
	type = country_event
	title = me_subject_independence.17.t
	desc = me_subject_independence.17.desc
	picture = senate_debate	# TODO adjust for different governments and cultures
	left_portrait = current_ruler
	right_portrait = scope:selected_family_head

	option = {	# Give them the bribe
		name = me_subject_independence.17.a
		add_treasury = -100
		scope:selected_family_head = {
			add_gold = 100
			add_corruption = corruption_large
			add_loyalty = family_head_pos_loyalty
		}
	}

	option = {	# Deny the bribe
		name = me_subject_independence.17.b
		scope:selected_family_head = {
			add_loyalty = family_head_neg_loyalty
		}
	}
}

me_subject_independence.18 = {	# Choice Event - FH asks for holdings
	type = country_event
	title = me_subject_independence.18.t
	desc = me_subject_independence.18.desc
	picture = senate_debate	# TODO adjust for different governments and cultures
	left_portrait = current_ruler
	right_portrait = scope:selected_family_head

	option = {	# Give them the holdings
		name = me_subject_independence.18.a
		while = {
			count = 5
			random_owned_province = {
				save_scope_as = tmp_holding_scope
			}
			scope:selected_family_head = {
				add_holding = scope:tmp_holding_scope
			}
		}
		scope:selected_family_head = {
			add_corruption = corruption_large
			add_loyalty = family_head_pos_loyalty
		}
	}

	option = {	# Deny the holdings
		name = me_subject_independence.18.b
		scope:selected_family_head = {
			add_loyalty = family_head_neg_loyalty
		}
	}
}

me_subject_independence.19 = {	# Choice Event - FH asks for minor advisor roles
	type = country_event
	title = me_subject_independence.19.t
	desc = me_subject_independence.19.desc
	picture = senate_debate	# TODO adjust for different governments and cultures
	left_portrait = current_ruler
	right_portrait = scope:selected_family_head

	option = {	# Give them the advisor titles
		name = me_subject_independence.19.a
		# TODO add the advisor status on a couple of adult characters in the family
		scope:selected_family_head = {
			add_character_modifier = {
				name = me_subject_advisor_charmod
				duration = 3650
			}
			next_in_family = {
				add_character_modifier = {
					name = me_subject_advisor_charmod
					duration = 3650
				}
				next_in_family = {
					add_character_modifier = {
						name = me_subject_advisor_charmod
						duration = 3650
					}
				}
			}
			add_corruption = corruption_large
			add_loyalty = family_head_pos_loyalty
		}
	}

	option = {	# Deny the titles
		name = me_subject_independence.19.b
		scope:selected_family_head = {
			add_loyalty = family_head_neg_loyalty
		}
	}
}

me_subject_independence.20 = {	# Choice Event - FH asks for nothing
	type = country_event
	title = me_subject_independence.20.t
	desc = me_subject_independence.20.desc
	picture = senate_debate	# TODO adjust for different governments and cultures
	left_portrait = current_ruler
	right_portrait = scope:selected_family_head

	option = {
		name = me_subject_independence.20.a
		scope:selected_family_head = {
			add_loyalty = family_head_pos_loyalty
		}
	}
}

me_subject_independence.21 = {	# Conluding task
	type = country_event
	title = me_subject_independence.21.t
	desc = me_subject_independence.21.desc
	picture = senate_debate	# TODO adjust for different governments and cultures
	left_portrait = current_ruler

	option = {
		name = me_subject_independence.21.a
	}
}
## Mission 5 (Left) - Preparing Character - start

## Mission 6 (Left) - Making Allies - start
me_subject_independence.25 = {	# Event to send gold or no to possible ally
	type = country_event
	title = me_subject_independence.25.t
	desc = me_subject_independence.25.desc
	picture = senate_debate	# TODO adjust for different governments and cultures
	left_portrait = current_ruler
	right_portrait = scope:tmp_ally_scope.current_ruler

	option = {	# Ask with gold
		name = me_subject_independence.25.a
		custom_tooltip = me_subject_independence.25.at
		add_treasury = -100
		scope:tmp_ally_scope = {
			set_variable = {
				name = tempted
				duration = 30
			}
			trigger_event = {
				id = me_subject_independence.26
				days = { 3 7 }
			}
		}
	}

	option = {	# Ask
		name = me_subject_independence.25.b
		custom_tooltip = me_subject_independence.25.bt
		scope:tmp_ally_scope = {
			trigger_event = {
				id = me_subject_independence.26
				days = { 3 7 }
			}
		}
	}

	option = {	# Don't ask
		name = me_subject_independence.25.c
		custom_tooltip = me_subject_independence.25.ct
	}
}

me_subject_independence.26 = {	# Potential ally gets the event
	type = country_event
	title = me_subject_independence.26.t
	desc = me_subject_independence.26.desc	# TODO if gold was offered, desc needs to mention that
	picture = senate_debate	# TODO adjust for different governments and cultures
	left_portrait = current_ruler
	right_portrait = scope:unwilling_subject.current_ruler
	right_portrait = scope:our_overlord.current_ruler

	option = {	# Accept the offer
		name = me_subject_independence.26.a
		custom_tooltip = me_subject_independence.26.at
		scope:unwilling_subject = {
			trigger_event = {
				id = me_subject_independence.27
				days = { 3 7 }
			}
		} # TODO ai chance calculation
	}

	option = {	# Decline the offer
		name = me_subject_independence.26.b
		custom_tooltip = me_subject_independence.26.bt
		scope:unwilling_subject = {
			trigger_event = {
				id = me_subject_independence.28
				days = { 3 7 }
			}
		} # TODO ai chance calculation
	}
}

me_subject_independence.27 = {	# Potential ally accepted
	type = country_event
	title = me_subject_independence.27.t
	desc = me_subject_independence.27.desc
	picture = senate_debate	# TODO adjust for different governments and cultures
	left_portrait = current_ruler
	left_portrait = scope:tmp_ally_scope.current_ruler
	right_portrait = scope:our_overlord.current_ruler

	option = {	# Okay
		name = me_subject_independence.27.a
	}
}

me_subject_independence.28 = {	# Potential ally declined
	type = country_event
	title = me_subject_independence.28.t
	desc = me_subject_independence.28.desc
	picture = senate_debate	# TODO adjust for different governments and cultures
	left_portrait = current_ruler
	right_portrait = scope:tmp_ally_scope.current_ruler

	option = {	# Okay
		name = me_subject_independence.28.a
	}
}
## Mission 6 (Left) - Making Allies - end