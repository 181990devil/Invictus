namespace = diadochi_flavor

#Fourth war of the diadochi
diadochi_flavor.15 = {
    type = country_event
    title = diadochi_flavor.15.t
    desc = diadochi_flavor.15.desc
   
	picture = greek_city
	
	left_portrait = current_ruler
	left_portrait = primary_heir
    right_portrait = c:MAC.current_ruler

	trigger = {
		has_variable = me_ant_start_flag
		c:MAC = {
			has_land = yes
			NOT = { war_with = ROOT }
		}
		NOR = {
			has_global_variable = fourth_war_triggered
			has_variable = antigonus_death
		}
	}
	
	immediate = {
		save_scope_as = antigonids_scope
		set_global_variable = {
			name = fourth_war_triggered
		}
		hidden_effect = {

			c:EGY = {
				trigger_event = {
					id = diadochi_flavor.20
					days = { 180 360 }
				}
			}
			c:SEL = {
				trigger_event = {
					id = diadochi_flavor.27
					days = { 360 420 }
				}
			}
			c:TRE = {
				trigger_event = {
					id = diadochi_flavor.40
					days = { 420 540 }
				}
			}
		}
	}
	
	option = {
		name = "diadochi_flavor.15.a"
		c:MAC = {
			trigger_event = {
				id = diadochi_flavor.16
				days = 5
			}
			custom_tooltip = "macedon_war_choice"
		}
		ai_chance = {
			modifier = {
				factor = 100
			}
		}
	}
	
	option = {
		name = "diadochi_flavor.15.b" 
		custom_tooltip = "diadochi_flavor.15.b.tooltip"
		ai_chance = {
			modifier = {
				factor = 0
			}
		}
		p:7902 = { #Salamis
			set_owned_by = c:ATH
		}
		p:442 = { #Aigina
			create_country = {
				name = {
					name = AIGINA_NAME
					adjective = AIGINA_ADJECTIVE
				}
				hidden_effect = {
					set_primary_culture = argolian
					set_country_religion = roman_pantheon
					change_government = plutocratic_republic
					change_country_color = mid_grey
					change_country_flag = AIGINA_FLAG
				}
			}
		}
		p:407 = { #Chalcis
			create_country = {
				name = {
					name = CHALKIS_NAME
					adjective = CHALKIS_ADJECTIVE
				}
				hidden_effect = {
					set_primary_culture = euboean
					set_country_religion = roman_pantheon
					change_government = oligarchic_republic
					change_country_color = samnite_green
					change_country_flag = CHALCIS_FLAG
				}
			}
		}
		every_subject = {
			limit = {
				capital_scope = {
					OR = {
						is_in_region = greece_region
						is_in_region = macedonia_region
					}
				}
			}
			hidden_effect = {
				add_truce = {
					target = PREV
					duration = 1825
				}
			}
			trigger_event = { id = diadochi_flavor.55 }
			scope:antigonids_scope = {
				hidden_effect = {
					add_truce = {
						target = PREV
						duration = 1825
					}
				}
			}
		}
		scope:antigonids_scope = {
			add_truce = {
				target = c:MAC
				duration = 1825
			}
			hidden_effect = {
				every_subject = {
					c:MAC = {
						add_truce = {
							target = PREV
							duration = 1825
						}
					}
				}
			}
		}
		c:MAC = {
			add_truce = {
				target = scope:antigonids_scope
				duration = 1825
			}
			trigger_event = {
				id = diadochi_flavor.17
				days = 5
			}
			hidden_effect = {
				every_subject = {
					scope:antigonids_scope = {
						add_truce = {
							target = PREV
							duration = 1825
						}
					}
				}
			}
		}
		custom_tooltip = "no_longer_champion_of_free_greeks"
		hidden_effect = {
			set_global_variable = phrygia_the_betrayer
			every_owned_province = { #If any remains
				limit = { is_in_region = greece_region }
				set_owned_by = c:ATH
			}
		}
	}
}

diadochi_flavor.16 = { #Macedon War Choice
    type = country_event
    title = diadochi_flavor.16.t
    desc = diadochi_flavor.16.desc
    
	picture = greek_political_discussion
	
	left_portrait = current_ruler
	right_portrait = scope:antigonids_scope.current_ruler
	
	trigger = {
		scope:antigonids_scope = {
			has_land = yes
		}
		NOR = {
			war_with = scope:antigonids_scope
			any_current_war = {
				any_war_attacker = { THIS = scope:antigonids_scope }
				any_war_attacker = { THIS = c:MAC }
			}
			any_current_war = {
				any_war_defender = { THIS = scope:antigonids_scope }
				any_war_defender = { THIS = c:MAC }
			}
		}
	}
	
	option = {
		name = "diadochi_flavor.16.a"
		add_stability = 8
		scope:antigonids_scope = {
			declare_war_with_wargoal = {
				war_goal = diadochi_wargoal
				#province = p:418
				target = c:MAC
			}
			trigger_event = diadochi_flavor.25 #Macedon declares war.
		}
		hidden_effect = {
			every_country = {
				limit = {
					country_culture_group = hellenic
					NOR = {
						tag = MAC
						THIS = scope:antigonids_scope
						war_with = c:MAC
						war_with = scope:antigonids_scope
					}
				}
				trigger_event = diadochi_flavor.19
			}
		}
		ai_chance = { factor = 99 }
	}
	
	option = {
		name = "diadochi_flavor.16.b"
		current_ruler = {
			add_popularity = subtract_popularity_large
		}
		if = {
			limit = {
				p:418 = {
					owner = root
				}
			}
			p:418 = {
				set_owned_by = scope:antigonids_scope
			}
		}
		scope:antigonids_scope = {
			add_truce = {
				target = c:MAC
				duration = 1825
			}
			hidden_effect = {
				every_subject = {
					c:MAC = {
						add_truce = {
							target = PREV
							duration = 1825
						}
					}
				}
			}
			trigger_event = {
				id = diadochi_flavor.18
			}
		}
		add_truce = {
			target = scope:antigonids_scope
			duration = 1825
		}
		hidden_effect = {
			every_subject = {
				scope:antigonids_scope = {
					add_truce = {
						target = PREV
						duration = 1825
					}
				}
			}
		}
		ai_chance = { factor = 1 }
	}
}

diadochi_flavor.20 = { #In defence of Cassander
    type = country_event
    title = diadochi_flavor.20.t
    desc = diadochi_flavor.20.desc
    
	picture = elephant_battle
	
	left_portrait = current_ruler
	left_portrait = c:MAC.current_ruler
	right_portrait = c:PRY.current_ruler
	
	trigger = {
		tag = EGY
		has_global_variable = fourth_war_triggered
		NOR = {
			war_with = c:MAC
			war_with = c:PRY
			has_truce_with = c:PRY
		}
	}
	
	option = {
		name = "diadochi_flavor.20.a"
		declare_war_with_wargoal = {
			war_goal = diadochi_wargoal
			target = c:PRY
		}
		every_country = {
			limit = {
				country_culture_group = hellenic
				NOR = {
					tag = PRY
					tag = EGY
				}
			}
			trigger_event = {
				id = diadochi_flavor.21
			}
		}
		c:PRY = {
			trigger_event = {
				id = diadochi_flavor.31
			}
		}
		ai_chance = {
			modifier = {
				factor = 40
			}
		}
	}
	
	option = {
		name = "diadochi_flavor.20.b"
		custom_tooltip = "offer_will_be_sent_egy"
		show_as_tooltip = {
			declare_war_with_wargoal = {
				war_goal = diadochi_wargoal
				target = c:PRY
			}
		}
		c:PRY = {
			trigger_event = {
				id = diadochi_flavor.22
				days = 5
			}
		}
		ai_chance = {
			factor = 55
		}
	}
	
	option = {
		name = "diadochi_flavor.20.c"
		custom_tooltip = "passive_egypt_tt"
		ai_chance = {
			factor = 5
		}
	}
}

diadochi_flavor.27 = { #A time to strike
    type = country_event
    title = diadochi_flavor.27.t
    desc = diadochi_flavor.27.desc
    
	picture = elephant_battle
	
	left_portrait = current_ruler
	right_portrait = c:PRY.current_ruler
	
	trigger = {
		tag = SEL
		has_global_variable = fourth_war_triggered
		NOR = {
			war_with = c:MAC
			war_with = c:PRY
			has_truce_with = c:PRY
		}
	}

	immediate = {
		random_country = {
			limit = { has_variable = me_ant_start_flag }
			save_scope_as = antigonids_scope
		}
	}
	
	option = {
		name = "diadochi_flavor.27.a" #Time for war
		declare_war_with_wargoal = {
			war_goal = diadochi_wargoal
			target = scope:antigonids_scope
		}
		every_country = {
			limit = {
				country_culture_group = hellenic
				NOR = {
					THIS = scope:antigonids_scope
					tag = SEL
				}
			}
			trigger_event = {
				id = diadochi_flavor.29
			}
		}
		scope:antigonids_scope = {
			trigger_event = {
				id = diadochi_flavor.30
			}
		}
		ai_chance = {
			factor = 80
			modifier = {
				war_with = MRY
				factor = 0
			}
		}
	}
	
	option = {
		name = "diadochi_flavor.27.b" #Send Demand To Phrygia
		custom_tooltip = "offer_will_be_sent_to_pry"
		show_as_tooltip = {
			declare_war_with_wargoal = {
				war_goal = diadochi_wargoal
				target = scope:antigonids_scope
			}
		}
		scope:antigonids_scope = {
			trigger_event = {
				id = diadochi_flavor.28
				days = 5
			}
		}
		ai_chance = {
			factor = 20
		}
	}
}

diadochi_flavor.40 = { #In defence of Cassander
    type = country_event
    title = diadochi_flavor.40.t
    desc = diadochi_flavor.40.desc
    
	picture = city_siege
	
	left_portrait = current_ruler
	left_portrait = c:MAC.current_ruler
	right_portrait = c:PRY.current_ruler
	
	trigger = {
		tag = TRE
		has_global_variable = fourth_war_triggered
		NOR = {
			war_with = c:MAC
			war_with = c:PRY
			has_truce_with = c:PRY
		}
	}
	
	option = {
		name = "diadochi_flavor.40.a"
		declare_war_with_wargoal = {
			war_goal = diadochi_wargoal
			target = c:PRY
		}
		every_country = {
			limit = {
				country_culture_group = hellenic
				NOR = {
					tag = PRY
					tag = TRE
				}
			}
			trigger_event = {
				id = diadochi_flavor.41
			}
		}
		c:PRY = {
			trigger_event = {
				id = diadochi_flavor.42
			}
		}
		ai_chance = {
			modifier = {
				factor = 40
			}
		}
	}
	
	option = {
		name = "diadochi_flavor.40.b"
		custom_tooltip = "offer_will_be_sent_tre"
		show_as_tooltip = {
			declare_war_with_wargoal = {
				war_goal = diadochi_wargoal
				target = c:PRY
			}
		}
		c:PRY = {
			trigger_event = {
				id = diadochi_flavor.43
				days = 5
			}
		}
		ai_chance = {
			factor = 20
		}
	}

	option = {
		name = "diadochi_flavor.40.c"
		if = {
			limit = {
				current_ruler = {
					NOT = { has_trait = content }
				}
			}
			current_ruler = { add_trait = content }
		}
		ai_chance = {
			factor = 20
		}
	}
}