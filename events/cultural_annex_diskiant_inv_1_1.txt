namespace = cultural_annexed_revolt

cultural_annexed_revolt.2 = {
    type = country_event
    title = "cultural_annexed_revolt.2.t"
    
	desc = {
		desc = "cultural_annexed_revolt.2.desc" 
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:unhappy_prov_gov = { is_ruler = no }
				}
				desc = cultural_annexed_revolt.2.desc_1
			}
		}
	}
    picture = proscription
    goto_location = scope:random_province_unhappy_cult
    left_portrait = scope:unhappy_prov_gov 

    trigger = {
		scope:target_annexed_culture = {
            is_integrated = no
            OR = {
                has_country_culture_modifier = annexed_my_home_culture
                has_country_culture_modifier = annexed_my_home_culture_lenient
            }
            NOR = {
                has_country_culture_modifier = annexed_culture_unhappy
                has_country_culture_modifier = despised_annexed_culture
                has_country_culture_modifier = protected_customs
                has_country_culture_modifier = respected_annexed_culture
            }
		}
    }

    immediate = {
        if = {
            limit = { 
                any_governorships = {
                    governor_or_ruler = {
                        NOT = { has_culture = scope:target_annexed_culture.culture }
                        OR = {
                            finesse >= 10
                            has_trait = prominent 
                            has_trait = silver_tongued 
                            has_trait = wise
                        }
                    }
                    any_governorship_state = {
                        any_state_province = {
                            dominant_province_culture = scope:target_annexed_culture.culture	
                        }
                    }
                }
            }
            
            random_governorships = {
                limit = {
                
                    governor_or_ruler = {
                        NOT = { has_culture = scope:target_annexed_culture.culture }
                        OR = {
                            finesse >= 10
                            has_trait = prominent 
                            has_trait = silver_tongued 
                            has_trait = wise
                        }
                    }
                    any_governorship_state = {
                        any_state_province = {
                            dominant_province_culture = scope:target_annexed_culture.culture	
                        }
                    }
                }
                governor_or_ruler = { 
                    save_scope_as = unhappy_prov_gov
                    random_governor_state = {
                        limit = {
                            any_state_province = {
                                dominant_province_culture = scope:target_annexed_culture.culture	
                            }
                        }
                        random_state_province = {
                            limit = {
                                dominant_province_culture = scope:target_annexed_culture.culture
                            }
                            weight = {
                                modifier = {
                                    add = total_population
                                }
                            }
                            save_scope_as = random_province_unhappy_cult
                        }
                    }
                }

            }
        }
        else = {
            
			ordered_owned_province = {
				limit = { dominant_province_culture = scope:target_annexed_culture.culture }
				max = 1
				order_by = total_population
				save_scope_as = random_province_unhappy_cult
			}
            scope:random_province_unhappy_cult = {
                if = {
                    limit = {
                        exists = governor_or_ruler
                    }
                    governor_or_ruler = {
                        save_scope_as = unhappy_prov_gov
                    }
                }
                else = {
                    root = {
                        current_ruler = {
                            save_scope_as = unhappy_prov_gov
                        }
                    }
                }
                
            
            }

        }
           
    }

    option = { 
        name = cultural_annexed_revolt.2.a
        scope:target_annexed_culture = {
            add_country_culture_modifier = {
                name = "annexed_culture_unhappy"
				duration = 3650
            }
        }
    }

    option = { 
        name = cultural_annexed_revolt.2.b
        current_ruler = {
            add_popularity = popularity_medium
            
        }
        if = {
            limit = { is_monarchy = yes }
            current_ruler = { add_legitimacy = legitimacy_small }
        }
        else if = {
            limit = {
                is_republic = yes
            }
            if = {
                limit = {
                    has_party_type = optimates_party
                }
                add_party_approval = {
                    party_type = optimates_party
                    VALUE = party_approval_small_svalue
                }
            }
            else = {
                add_party_approval = {
                    party_type = oligarchic_party
                    VALUE = party_approval_small_svalue
                }
            }
        }
        if = {
            limit = {
                is_tribal = yes
             }
            add_centralization = 5
        }
        scope:target_annexed_culture = {
            add_country_culture_modifier = {
                name = "despised_annexed_culture"
				duration = 3650
            }
        }
    }
    option = {
        name = cultural_annexed_revolt.2.c
        trigger = {
            scope:unhappy_prov_gov = {
                OR = {
                    has_culture = scope:target_annexed_culture.culture
                    NOR = { 
                        has_trait = harsh
                        has_trait = rash
                    }
                }
            }
        }
        
        current_ruler = {
            add_popularity = subtract_popularity_medium
        }
        if = {
            limit = {
                is_republic = yes
            }
            if = {
                limit = {
                    has_party_type = populares_party
                }
                add_party_approval = {
                    party_type = populares_party
                    VALUE = party_approval_small_svalue
                }
            }
            else = {
                add_party_approval = {
                    party_type = democratic_party
                    VALUE = party_approval_small_svalue
                }
            }
        }
        else_if = {
            limit = {
                is_tribal = yes
             }
             add_centralization = -5
        }
        scope:target_annexed_culture = {
            add_country_culture_modifier = {
                name = "protected_customs"
				duration = 3650
            }
        }
    }
    option = {
        name = cultural_annexed_revolt.2.d
        trigger = {
            scope:unhappy_prov_gov = {
                NOR = { 
                    has_culture = scope:target_annexed_culture.culture
                    has_trait = harsh
                    has_trait = rash
                }
                OR = {
                    finesse >= 10
                    has_trait = prominent 
                    has_trait = silver_tongued 
                    has_trait = wise
                }
            }
        }
        
        if = {
            limit = { 
                scope:unhappy_prov_gov = {
                    finesse >= 10
                }
            }
            custom_tooltip = cultural_annexed_revolt.2.d.tt1
        }
        else_if = {
            limit = { 
                scope:unhappy_prov_gov = {
                    has_trait = prominent 
                }
            }
            custom_tooltip = cultural_annexed_revolt.2.d.tt2
        }
        else_if = {
            limit = { 
                scope:unhappy_prov_gov = {
                    has_trait = silver_tongued
                }
            }
            custom_tooltip = cultural_annexed_revolt.2.d.tt3
        }
        else_if = {
            limit = { 
                scope:unhappy_prov_gov = {
                    has_trait = wise
                }
            }
            custom_tooltip = cultural_annexed_revolt.2.d.tt4
        }
        highlight = yes
        scope:target_annexed_culture = {
            add_country_culture_modifier = {
                name = "respected_annexed_culture"
				duration = 1825
            }
        }

    }
    after = { 

    }
}
cultural_annexed_revolt.1 = { #iterator through every culture to see if they're triggerable
    
    type = country_event
    immediate = {
        every_country_culture = {
            limit = {
                is_integrated = no
                OR = {
                    has_country_culture_modifier = annexed_my_home_culture
                    has_country_culture_modifier = annexed_my_home_culture_lenient
                }
                NOR = {
                    has_country_culture_modifier = annexed_culture_unhappy
                    has_country_culture_modifier = despised_annexed_culture
                    has_country_culture_modifier = protected_customs
                    has_country_culture_modifier = respected_annexed_culture
                }
            }
            save_scope_as = target_annexed_culture
            random_list = {
                50 = {}
                2 = {
                    modifier = {
                        factor = 2
                        scope:target_annexed_culture = {
                            is_integrated = no
                            country_culture_pop_count >= 50
                        }
                    } 
                    modifier = {
                        factor = 2
                        scope:target_annexed_culture = {
                            is_integrated = no
                            country_culture_pop_count >= 150
                        }
                    }
                    modifier = {
                        factor = 3
                        scope:target_annexed_culture = {
                            is_integrated = no
                            country_culture_pop_count >= 500
                        }
                    }
                    root = {
                        trigger_event = { 
                            id = cultural_annexed_revolt.2
                            days = {1 360}
                        }
                    }
                }
            }
        }
    }
}