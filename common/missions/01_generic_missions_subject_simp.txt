gm_subject_simp = {
	icon = general_2
	header = mission_image_general

	repeatable = yes

	ai_chance = {
		base = 0
	}

	potential = {
#		is_ai = no	# Caused a problem where it would need 1 day tick to become visible
		is_subject = yes
		has_civil_war = no
		NOT = {
			has_variable = gm_subject_simp
		}
	}

	on_start = {
		save_scope_as = willing_subject
		overlord = {
			save_scope_as = our_overlord
		}
	}

	on_completion = {
		add_stability = 10
		complete_mission_effect = yes
		hidden_effect = {
			set_variable = {
				name = gm_subject_simp
				days = 7300	# 20 years
			}
		}
	}

	abort = {
		is_ai = yes
	}
	on_abort = {
		add_stability = -5
		hidden_effect = {
			set_variable = {
				name = gm_subject_simp
				days = 7300	# 20 years
			}
		}
	}

	gm_subject_simp_1a = {	# 1a - Economic vassal
		icon = "task_economical"
		duration = 90

		prevented_by = { gm_subject_simp_1b }

		bypass = {
			has_variable = chose_path
		}

		allow = {
			scope:our_overlord = {
				opinion = {
					target = scope:willing_subject
					value >= 100
				}
			}
			is_subject = yes
		}

		on_completion = {
			set_variable = {
				name = chose_path
			}
		}
	}

	gm_subject_simp_2a = {	# 2a - Capital improvements
		icon = "task_economical"

		requires = { gm_subject_simp_1a }

		allow = {
			capital_scope = {
				OR = {
					AND = {
						num_of_commerce_building >= 1
						num_of_forum_building >= 1
					}
					AND = {
						num_of_library_building >= 1
						num_of_court_building >= 1
					}
					num_of_local_forum_building >= 1
				}
			}
			is_subject = yes
		}
	}

	gm_subject_simp_3a = {	# 3a - Increase your income
		icon = "task_economical"

		requires = { gm_subject_simp_2a }

		allow = {
			treasury >= 1000
			is_subject = yes
		}
	}

	gm_subject_simp_4a = {	# 4a - Optimize research
		icon = "task_economical"

		requires = { gm_subject_simp_3a }

		allow = {
			capital_scope = {
				nobles_happiness >= 60
				citizen_happiness >= 80
				num_of_nobles >= 5
				num_of_citizen >= 10
			}
			is_subject = yes
		}

		on_completion = {
			add_research = {
				technology = military_tech
				value = 25
			}
			add_research = {
				technology = civic_tech
				value = 25
			}
			add_research = {
				technology = oratory_tech
				value = 25
			}
			add_research = {
				technology = religious_tech
				value = 25
			}
		}
	}

	gm_subject_simp_5a = {	# 5a - Final task
		icon = "task_diplomatic"
		final = yes
		duration = 180

		requires = { gm_subject_simp_4a gm_subject_simp_3c }

		allow = {
			scope:our_overlord = {
				opinion = {
					target = scope:willing_subject
					value >= 150
				}
			}
			is_subject = yes
		}

		on_completion = {
			overlord = {
				release_subject = root
				make_subject = {
					target = root
					type = simp_colony
				}
			}
		}
	}

	gm_subject_simp_6a = {	# 6a - Optional: Trade a specific thing with the overlord
		icon = "task_economical"
		duration = 60

		requires = { gm_subject_simp_2a }

		allow = {
			capital_scope = {
				AND = {
					is_importing_trade_good = glass
					is_importing_trade_good = papyrus
				}
			}
			is_subject = yes
		}
	}

	gm_subject_simp_7a = {	# 7a - Level up a port
		icon = "task_economical"
		duration = 60

		requires = { gm_subject_simp_3a }

		allow = {
			any_owned_province = {
				num_of_port_building >= 3
			}
			is_subject = yes
		}
	}


	gm_subject_simp_1b = {	# 1b - Military vassal
		icon = "task_conquest"
		duration = 90

		prevented_by = { gm_subject_simp_1a }

		bypass = {
			has_variable = chose_path
		}

		allow = {
			scope:our_overlord = {
				opinion = {
					target = scope:willing_subject
					value >= 100
				}
			}
			is_subject = yes
		}

		on_completion = {
			set_variable = {
				name = chose_path
			}
		}
	}

	gm_subject_simp_2b = {	# 2b - Increase reserves
		icon = "task_conquest"

		requires = { gm_subject_simp_1b }

		allow = {
			max_manpower >= 10	# 5K manpower
			is_subject = yes
		}
	}

	gm_subject_simp_3b = {	# 3b - Gain legion law
		icon = "task_conquest"

		requires = { gm_subject_simp_2b }

		allow = {
			manpower_percentage >= 0.8	# 80% needs to be filled
			is_subject = yes
		}

		on_completion = {
			if = {
				limit = {
					is_republic = yes
				}
				change_law = republican_recruitment_2
			}
			else_if = {
				limit = {
					is_monarchy = yes
				}
				change_law = work_for_the_best
			}
			else_if = {
				limit = {
					tag = ROM
				}
				change_law = punic_reforms
			}
		}
	}

	gm_subject_simp_4b = {	# 4b - Legion filled up
		icon = "task_conquest"

		requires = { gm_subject_simp_3b }

		allow = {
			any_legion = {
				unit_count >= 10
			}
			is_subject = yes
		}

		on_completion = {
			#add country modifier, maybe grant a distinction
		}
	}

	gm_subject_simp_5b = {	# 5b - Final task
		icon = "task_diplomatic"
		final = yes
		duration = 180

		requires = { gm_subject_simp_4b gm_subject_simp_3c }

		allow = {
			scope:our_overlord = {
				opinion = {
					target = scope:willing_subject
					value >= 150
				}
			}
			is_subject = yes
		}

		on_completion = {
			overlord = {
				release_subject = root
				make_subject = {
					target = root
					type = simp_mercenary_state
				}
			}
		}
	}

	gm_subject_simp_6b = {	# 6b - Optional: Get general from overlord/merc company
		icon = "task_conquest"
		duration = 60

		requires = { gm_subject_simp_2b }

		allow = {
			treasury >= 100
			is_subject = yes
		}

		on_completion = {
			create_character = {
				culture = scope:our_overlord.culture
				religion = scope:our_overlord.religion
				age = 18
				female = no
				no_traits = yes
				amazing_martial_effect = yes
				add_trait = steadfast
			}
		}
	}

	gm_subject_simp_7b = {	# 7b - Optional: Military training
		icon = "task_conquest"
		duration = 60

		requires = { gm_subject_simp_3b }

		allow = {
			military_experience >= 100
			is_subject = yes
		}

		on_completion = {
			add_military_experience = -100
			add_research = {
				technology = military_tech
				value = 80
			}
		}
	}


	gm_subject_simp_1c = {	# 1c - Ask support from overlord
		icon = "task_political"

		requires = { gm_subject_simp_1a gm_subject_simp_1b }

		allow = {
			is_subject = yes
		}
	}

	gm_subject_simp_2c = {	# 2c - Overlord invests military >< business
		icon = "task_political"
		duration = 180

		requires = { gm_subject_simp_1c }

		allow = {
			is_subject = yes
		}

		on_completion = {
			capital_scope.state = {
				add_state_modifier = {
					name = state_improvement_military
					duration = -1
					mode = add
				}
				add_state_modifier = {
					name = state_improvement_oratory
					duration = -1
					mode = add
				}
			}
		}
	}

	gm_subject_simp_3c = {	# 3c - Overlord invests infrastructure >< religious
		icon = "task_political"
		duration = 180

		requires = { gm_subject_simp_2c }

		allow = {
			is_subject = yes
		}

		on_completion = {
			capital_scope.state = {
				add_state_modifier = {
					name = state_improvement_civic
					duration = -1
					mode = add
				}
				add_state_modifier = {
					name = state_improvement_religious
					duration = -1
					mode = add
				}
			}
		}
	}

	gm_subject_simp_4c = {	# 4c - Optional: Request funds/PP/milxp
		icon = "task_political"

		requires = { gm_subject_simp_1c }

		allow = {
			is_subject = yes
		}

		on_completion = {
			add_treasury = 200
			add_political_influence = 100
			add_military_experience = 30
		}
	}

	gm_subject_simp_5c = {	# 5c - Optional: Request land in your main area
		icon = "task_political"

		requires = { gm_subject_simp_1c }

		allow = {
			is_subject = yes
		}

		on_completion = {
			capital_scope.area = {
				if = {
					limit = {
						NOT = {
							this.region = scope:our_overlord.capital_scope.region
						}
					}
					every_area_province = {
						limit = {
							owned_or_subject_owned = scope:our_overlord
							owner = {
								NOT = {
									this = root
									is_subject_type = tributary
									is_subject_type = vassal_tribe
									is_subject_type = subject_mercenary_city_state
									is_subject_type = subject_colony
									is_subject_type = subject_league_city_state
								}
							}
						}
						set_owned_by = scope:willing_subject
					}
				}
				else = {
					every_area_province = {
						limit = {
							owned_or_subject_owned = scope:our_overlord
							owner = {
								NOT = {
									this = scope:our_overlord
									this = root
									is_subject_type = tributary
									is_subject_type = vassal_tribe
									is_subject_type = subject_mercenary_city_state
									is_subject_type = subject_colony
									is_subject_type = subject_league_city_state
								}
							}
						}
						set_owned_by = scope:willing_subject
					}
				}
			}
#			scope:our_overlord = {
#				every_subject = {
#					limit = {
#						capital_scope = {
#							is_in_area = scythia_area
#						}
#						NOT = {
#							this = root
#						}
#					}
#					scope:our_overlord = {
#						release_subject = prev
#					}
#					scope:willing_subject = {
#						make_subject = {
#							target = prev
#							type = client_state
#						}
#					}
#				}
#			}
		}
	}
}