gm_subject_independence = {
	icon = generic_greek_3
	header = mission_image_generic_greek

	repeatable = yes

	potential = {
		is_ai = no
		is_subject = yes
		has_civil_war = no
	}

	on_start = {
		add_country_modifier = {
			name = gm_subject_stability_cmod
			duration = 1825	# 5 years
		}
		save_scope_as = unwilling_subject
		overlord = {
			save_scope_as = our_overlord
		}
		random_character = {	# Military char
			limit = {
				has_any_office = yes
				is_ruler = no
				highest_skill = martial
			}
			save_scope_as = random_left_advisor
		}
		random_character = {	# Diplomatic char
			limit = {
				has_any_office = yes
				is_ruler = no
				highest_skill = charisma
			}
			save_scope_as = random_right_advisor
		}
	}

	on_completion = {
		add_country_modifier = {
			name = gm_subject_reward_cmod
			duration = 3650	# 10 years
		}
		complete_mission_effect = yes
	}

	abort = {
		is_ai = yes
	}
	on_abort = {
		add_stability = -5
	}




	gm_subject_independence_1 = {	# 1 - Internal discussion of independence
		icon = "task_political"
		duration = 180

		allow = {
			stability >= 50
		}

		on_start = {
			hidden_effect = {
				set_variable = {
					name = discussion_progress
					value = 0
				}
				set_variable = {
					name = left_argument_points
					value = 0
				}
				set_variable = {
					name = right_argument_points
					value = 0
				}
			}
			trigger_event = {
				id = me_subject_independence.1
			}
			trigger_event = {
				id = me_subject_independence.2
				days = 25
			}
		}
		
		on_completion = {
			custom_tooltip = gm_subject_independence_1.tt
			hidden_effect = {
				if = {	# Left side superior
					limit = {
						has_variable = left_won
					}
					trigger_event = {
						id = me_subject_independence.10
					}
				}
				else_if = {	# Right side superior
					limit = {
						has_variable = right_won
					}
					trigger_event = {
						id = me_subject_independence.11
					}
				}
				else = {	# Stalemate
					trigger_event = {
						id = me_subject_independence.12
					}
				}
			}
		}
	}



	gm_subject_independence_2a = {	# 2 (Left) - Starting hostile posture against overlord
		icon = "task_expansion"

		requires = { gm_subject_independence_1 }

		prevented_by = { gm_subject_independence_2b }
		
		on_completion = {
			if = {
				limit = {
					has_variable = right_won
				}
				add_stability = -30
			}
			else_if = {
				limit = {
					has_variable = stalemate_won
				}
				add_stability = -10
			}
			reverse_add_opinion = {
				modifier = agressive_stance_neg_opmod
				target = scope:our_overlord
			}
			custom_tooltip = gm_subject_independence_2a.tt
			hidden_effect = {
				trigger_event = {
					id = me_subject_independence.13
				}
				scope:our_overlord = {
					trigger_event = {
						id = me_subject_independence.14
					}
				}
				scope:random_right_advisor = {
					add_to_list = spurned_chars_list
				}
				set_variable = {
					name = bad_boy_points
					value = 1
				}
			}
		}
	}

	gm_subject_independence_3a = {	# 3 (Left) - Building Defenses
		icon = "task_conquest"

		requires = { gm_subject_independence_2a }

		allow = {
			capital_scope = {
				has_building = fortress_building
			}
		}

		on_completion = {
			capital_scope = {
				add_province_modifier = {
					name = gm_subject_defensive_pmod
					duration = 5475	# 15 years
				}
			}
			hidden_effect = {
				trigger_event = {
					id = me_subject_independence.50
				}
				change_variable = {
					name = bad_boy_points
					add = 1
				}
			}
		}
	}

	gm_subject_independence_4a = {	# 4 (Left) - Army Boon
		icon = "task_conquest"

		requires = { gm_subject_independence_3a }

		bypass = {
			has_variable = prepping_ultimatum
		}

		allow = {
			manpower_percentage >= 0.6
		}

		on_completion = {
			add_country_modifier = {
				name = gm_subject_army_cmod
				duration = 3650	# 10 years
			}
			hidden_effect = {
				trigger_event = {
					id = me_subject_independence.51
				}
				change_variable = {
					name = bad_boy_points
					add = 1
				}
			}
		}
	}

	gm_subject_independence_5a = {	# 5 (Left) - Preparing Characters
		icon = "task_political"
		duration = 60

		requires = { gm_subject_independence_2a }

		bypass = {
			has_variable = prepping_ultimatum
		}

		allow = {
			political_influence >= 10
		}

		on_start = {
			add_political_influence = -10
			every_character = {
				limit = {
					is_head_of_family = yes
					is_ruler = no
				}
				add_to_list = family_heads_list
			}
			set_variable = {
				name = fh_progress
				value = 0
			}
			trigger_event = {
				id = me_subject_independence.15
			}
			trigger_event = {
				id = me_subject_independence.16
				days = 15
			}
		}

		on_completion = {
			trigger_event = {
				id = me_subject_independence.21
			}
			hidden_effect = {
				change_variable = {
					name = bad_boy_points
					add = 1
				}
			}
		}
	}

	gm_subject_independence_6a = {	# 6 (Left) - Making Allies
		icon = "task_diplomatic"

		requires = { gm_subject_independence_5a }

		bypass = {
			has_variable = prepping_ultimatum
		}

		allow = {
			treasury >= 100
			custom_tooltip = {
				text = gm_subject_independence_6a.allow
				any_country = {
					in_diplomatic_range = scope:unwilling_subject
					rank = scope:our_overlord.rank
					NOT = {
						this = scope:our_overlord
						alliance_with = scope:our_overlord
					}
				}
			}
		}

		on_completion = {
			custom_tooltip = gm_subject_independence_6a.tt
			hidden_effect = {
				every_country = {
					limit = {
						in_diplomatic_range = scope:unwilling_subject
						rank = scope:our_overlord.rank
						NOT = {
							this = scope:our_overlord
							alliance_with = scope:our_overlord
						}
					}
					add_to_list = possible_allies_list
				}
				while = {
					count = 3
					random_in_list = {
						list = possible_allies_list
						save_scope_as = tmp_ally_scope
						remove_from_list = possible_allies_list
					}
					trigger_event = {
						id = me_subject_independence.25
					}
				}
				every_in_list = {
					list = possible_allies_list
					remove_from_list = possible_allies_list
				}
				change_variable = {
					name = bad_boy_points
					add = 1
				}
			}
		}
	}

	gm_subject_independence_7a = {	# 7 (Left) - Asking For Favours
		icon = "task_political"

		requires = { gm_subject_independence_5a }

		bypass = {
			has_variable = prepping_ultimatum
		}

		on_completion = {
			custom_tooltip = gm_subject_independence_7a.tt
			hidden_effect = {
				# Family head
				random_character = {
					limit = {
						is_head_of_family = yes
						is_ruler = no
					}
					save_scope_as = selected_family_head
				}
				# Friendly neighbour
				random_country = {
					limit = {
						in_diplomatic_range = root
						NOT = {
							this = scope:our_overlord
							this = root
							alliance_with = scope:our_overlord
						}
						opinion = {
							target = root
							value >= 20
						}
					}
					save_scope_as = selected_friendly_neighbour
				}
				# Government character
				random_character = {
					limit = {
						is_head_of_family = no
						has_any_office = yes
						NOT = {
							OR = {
								has_office = office_high_priest_monarchy
								has_office = office_augur
								has_office = office_high_priest
							}
						}
						is_ruler = no
					}
					save_scope_as = selected_office_boy
				}
				# Religious head
				random_character = {
					limit = {
						OR = {
							has_office = office_high_priest_monarchy
							has_office = office_augur
							has_office = office_high_priest
						}
						is_ruler = no
					}
					save_scope_as = selected_high_priest
				}
				trigger_event = {
					id = me_subject_independence.30
				}
				change_variable = {
					name = bad_boy_points
					add = 1
				}
			}
		}
	}

	gm_subject_independence_8a = {	# 8 (Left) - Navy Boon
		icon = "task_expansion"

		requires = { gm_subject_independence_3a }

		bypass = {
			has_variable = prepping_ultimatum
		}

		allow = {
			num_of_ships >= 20
		}

		on_completion = {
			add_country_modifier = {
				name = gm_subject_navy_cmod
				duration = 3650	# 10 years
			}
			hidden_effect = {
				trigger_event = {
					id = me_subject_independence.52
				}
				change_variable = {
					name = bad_boy_points
					add = 1
				}
			}
		}
	}

	
	gm_subject_independence_9a = {	# 9 (Left) - Making Final Preparations
		icon = "task_political"
		duration = 180

		requires = { gm_subject_independence_3a }

		allow = {
			stability >= 60
		}

		on_start = {
			reverse_add_opinion = {
				modifier = agressive_stance_neg_opmod
				target = scope:our_overlord
			}
			custom_tooltip = gm_subject_independence_9a.tt
			hidden_effect = {
				every_character = {
					limit = {
						has_variable = spurned_var
					}
					remove_variable = spurned_var
					add_to_list = spurned_chars_list
				}
				set_variable = {
					name = prepping_ultimatum
					days = 3650
				}
				set_variable = {
					name = discussion_progress
					value = 0
				}
				trigger_event = {
					id = me_subject_independence.40
				}
				trigger_event = {
					id = me_subject_independence.41
					days = { 25 30 }
				}
			}
		}

		on_completion = {
			hidden_effect = {
				trigger_event = {
					id = me_subject_independence.45
				}
				change_variable = {
					name = bad_boy_points
					add = 1
				}
			}
		}
	}

	gm_subject_independence_10a = {	# 10 (Left) - Sending proposal with bad intentions
		icon = "task_conquest"

		requires = {
			gm_subject_independence_9a
		}

		on_completion = {
			reverse_add_opinion = {
				modifier = ultimatum_neg_opmod
				target = scope:our_overlord
			}
			custom_tooltip = gm_subject_independence_10a.tt
			hidden_effect = {
				every_country = {
					limit = {
						has_variable = pledged_support
					}
					remove_variable = pledged_support
					add_to_list = confirmed_backers_list
				}
				trigger_event = {
					id = me_subject_independence.60
				}
				scope:our_overlord = {
					trigger_event = {
						id = me_subject_independence.61
					}
				}
			}
		}
	}

	gm_subject_independence_11a = {	# 11 (Left) - Military Victory
		icon = "task_expansion"
		final = yes

		requires = { gm_subject_independence_10a }

		allow = {
			is_subject = no
			war = no
		}

		on_completion = {
			trigger_event = {
				id = me_subject_independence.65
			}
		}
	}

	


	gm_subject_independence_2b = {	# 2 (Right) - Starting friendly posture against overlord
		icon = "task_diplomatic"

		requires = { gm_subject_independence_1 }

		prevented_by = { gm_subject_independence_2a }

		on_completion = {
			if = {
				limit = {
					has_variable = left_won
				}
				add_stability = -30
			}
			else_if = {
				limit = {
					has_variable = stalemate_won
				}
				add_stability = -10
			}
			reverse_add_opinion = {
				modifier = diplomatic_stance_pos_opmod
				target = scope:our_overlord
			}
			custom_tooltip = gm_subject_independence_2b.tt
			hidden_effect = {
				scope:random_left_advisor = {
					add_to_list = spurned_chars_list
				}
				set_variable = {
					name = good_boy_points
					value = 1
				}
			}
		}
	}

	gm_subject_independence_3b = {	# 3 (Right) - Building Relations
		icon = "task_diplomatic"

		requires = { gm_subject_independence_2b }

		allow = {
			scope:our_overlord = {
				opinion = {
					target = root
					value >= 100
				}
			}
		}

		on_completion = {
			current_ruler = {
				add_popularity = popularity_large
			}
			hidden_effect = {
				change_variable = {
					name = good_boy_points
					add = 1
				}
			}
		}
	}

	gm_subject_independence_4b = {	# 4 (Right) - Marriage/Character exchange
		icon = "task_diplomatic"

		requires = { gm_subject_independence_7b }

		on_completion = {
			hidden_effect = {
				change_variable = {
					name = good_boy_points
					add = 1
				}
			}
		}
	}

	gm_subject_independence_5b = {	# 5 (Right) - Building Capital
		icon = "task_economical"

		requires = { gm_subject_independence_3b }

		allow = {
			capital_scope = {
				OR = {
					AND = {
						num_of_commerce_building >= 1
						num_of_forum_building >= 1
					}
					AND = {
						num_of_library_building >= 1
						num_of_academy_building >= 1
					}
				}
			}
		}

		on_completion = {
			capital_scope = {
				add_province_modifier = {
					name = gm_subject_building_pmod
					duration = 3650	# 10 years
				}
			}
			hidden_effect = {
				change_variable = {
					name = good_boy_points
					add = 1
				}
			}
		}
	}

	gm_subject_independence_6b = {	# 6 (Right) - Sharing your wealth
		icon = "task_economical"

		requires = { gm_subject_independence_3b }

		allow = {
			treasury >= 100
		}

		on_completion = {
			add_treasury = -100
			scope:our_overlord = {
				add_opinion	= {
					modifier = shared_wealth_pos_opmod
					target = root
				}
			}
			hidden_effect = {
				change_variable = {
					name = good_boy_points
					add = 1
				}
			}
		}
	}

	gm_subject_independence_7b = {	# 7 (Right) - Bribe the Overlord Ruler
		icon = "task_economical"

		requires = { gm_subject_independence_2b }

		allow = {
			treasury >= 50
		}

		on_completion = {
			add_treasury = -50
			scope:our_overlord = {
				current_ruler = {
					add_gold = 50
					add_corruption = corruption_large
				}
			}
			hidden_effect = {
				change_variable = {
					name = good_boy_points
					add = 1
				}
			}
		}
	}

	gm_subject_independence_8b = {	# 8 (Right) - Befriend the Overlord Ruler
		icon = "task_political"

		requires = { gm_subject_independence_7b }

		allow = {
			current_ruler = {
				is_friend = scope:our_overlord.current_ruler
			}
		}

		on_completion = {
			current_ruler = {
				add_popularity = popularity_large
			}
			hidden_effect = {
				change_variable = {
					name = good_boy_points
					add = 1
				}
			}
		}
	}


	gm_subject_independence_9b = {	# 9 (Right) - Drafting The Proposal
		icon = "task_political"
		duration = 60

		requires = { gm_subject_independence_3b }
	}

	gm_subject_independence_10b = {	# 10 (Right) - Sending proposal with good intentions
		icon = "task_diplomatic"

		requires = { gm_subject_independence_9b }
	}

	gm_subject_independence_11b = {	# 11a (Right) - Overlord accepted granting independence
		icon = "task_diplomatic"
		final = yes

		requires = { gm_subject_independence_10b }
	}



	gm_subject_independence_11c = {	# 11b (Right) - Overlord denied granting independence
		icon = "task_political"

		requires = { gm_subject_independence_10b }
	}

	gm_subject_independence_12c = {	# 12 (Right) - Building up defenses
		icon = "task_conquest"

		requires = { gm_subject_independence_11c }
	}

	gm_subject_independence_13c = {	# 13 (Right) - Allying rivaling powers of overlord
		icon = "task_diplomatic"

		requires = { gm_subject_independence_11c }
	}

	gm_subject_independence_14c = {	# 14 (Right) - Rallying the people
		icon = "task_political"

		requires = { gm_subject_independence_11c }
	}

	gm_subject_independence_15c = {	# 15 (Right) - Declaring war on your overlord
		icon = "task_conquest"

		requires = { gm_subject_independence_14c }
	}

	gm_subject_independence_16c = {	# 16 (Right) - Military Victory
		icon = "task_expansion"
		final = yes

		requires = { gm_subject_independence_15c }
	}
}