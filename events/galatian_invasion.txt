namespace = galatian_invasion


galatian_invasion.1 = { # AI gateway check
	type = country_event
	# title = "galatian_invasion.1.t"
	# desc = "galatian_invasion.1.desc"
	hidden = yes
	
	trigger = {
		
		# trigger_if = {
			# limit = {
				# OR = {
					# tag = SDI
					# tag = DRD
					# tag = TBL
				# }
			# }
			# is_ai = yes
		# }
		
		# c:SDI = {
			# is_ai = yes
		# }
		# c:DRD = {
			# is_ai = yes
		# }
		# c:TBL = {
			# is_ai = yes
		# }
		
		# has_global_variable = fourth_war_triggered
		OR = {
			AND = {
				current_date > 455.1.1
				c:MAC = {
					NOT = { owns = 379 }
				}
			}
			c:SEL = {
				any_owned_province = {
					is_in_region = galatia_region
				}
			}
			current_date > 470.1.1
		}

	}
	
	fire_only_once = yes
	
	immediate = {

	}	
	
	option = {
		# name = galatian_invasion.1.a
	}
	
	after = {
		trigger_event = {
			id = galatian_invasion.2
			# days = 1
		}
	}
}

galatian_invasion.2 = { # Barbarian Rumblings
	type = country_event
	title = "galatian_invasion.2.t"
	desc = "galatian_invasion.2.desc"
	
	left_portrait = scope:pella_attacker.current_ruler
	left_portrait = scope:delphi_attacker.current_ruler
	left_portrait = scope:phrygia_attacker.current_ruler
	right_portrait = current_ruler
	
	trigger = {

	}
	
	immediate = {
		if ={
			limit = {
				c:TLT = { exists = yes }
			}
			c:TLT = { 
				save_scope_as = pella_attacker
			}
		}
		else = {
			random_country = {
				limit = {
					country_culture_group = celto_pannonian_group
					capital_scope = {
						OR = {
							is_in_region = macedonia_region
							is_in_region = moesia_region
							is_in_region = pannonia_region
						}
					}
				}
				save_scope_as = pella_attacker
			}
		}
		if ={
			limit = {
				c:DND = { exists = yes }
			}
			c:DND = { # Dardania
				save_scope_as = delphi_attacker
			}
		}
		else = {
			random_country = {
				limit = {
					country_culture_group = celto_pannonian_group
					capital_scope = {
						OR = {
							is_in_region = macedonia_region
							is_in_region = moesia_region
							is_in_region = pannonia_region
						}
					}
					NOT = { this = scope:pella_attacker }
				}
				save_scope_as = delphi_attacker
			}
		}
		if ={
			limit = {
				c:SCD = { exists = yes }
			}
			c:SCD = {
				save_scope_as = phrygia_attacker
			}
		}
		else = {
			random_country = {
				limit = {
					country_culture_group = celto_pannonian_group
					capital_scope = {
						OR = {
							is_in_region = macedonia_region
							is_in_region = moesia_region
							is_in_region = pannonia_region
						}
					}
					NOR = {
						this = scope:pella_attacker
						this = scope:delphi_attacker
					}
				}
				save_scope_as = phrygia_attacker
			}
		}
	}	
	
	option = {
		name = galatian_invasion.2.a
		
		trigger_event = {
			id = galatian_invasion.10
			days = 30
		}
		trigger_event = {
			id = galatian_invasion.20
			days = 60
		}
		trigger_event = {
			id = galatian_invasion.30
			days = 90
		}
	}
}

galatian_invasion.10 = {
	type = country_event
	title = "galatian_invasion.10.t"
	desc = "galatian_invasion.10.desc"
	
	left_portrait = scope:pella_attacker.current_ruler
	right_portrait = scope:pella_defender.current_ruler
	goto_location = root
	
	trigger = {
		owns = 379
	}
	
	immediate = { # invade
	
		random_country = {
			limit = {
				owns = 379
			}
			save_scope_as = pella_defender
		}
		
		scope:pella_attacker = {
			declare_war_with_wargoal = {
				war_goal = conquer_wargoal
				province = p:379
				target = scope:pella_defender
			}
			create_unit = {
				navy = no
				location = p:384 
				while = {
					count = 39
					add_subunit = light_infantry
				}
				while = {
					count = 10
					add_subunit = chariots
				}
			}
			# save_scope_as = first_gauls
		}
		
		random_current_war = {
			limit = {
				any_war_attacker = { this = scope:pella_attacker }
				any_war_defender = { this = scope:pella_defender }
			}
			save_scope_as = first_galatian_war_scope
		}
	}
	
	option = {
		name = galatian_invasion.10.a
	}
		
	# option = {
		# name = galatian_invasion.2.b # 

	# }
	
	after = {
		c:TRE = {
			trigger_event = {
				id = galatian_invasion.11
				days = 1
			}
		}
		
		every_country = {
			limit = {
				country_culture_group = hellenic
			}
			trigger_event = {
				id = galatian_invasion.12
				days = 3
			}
		}

	}
	
}

galatian_invasion.11 = { # Help from Thrace
	type = country_event
	title = "galatian_invasion.11.t"
	desc = "galatian_invasion.11.desc"
	
	trigger = {
		tag = TRE 
		is_ai = no
	}
	
	# immediate = {

	# }	
	
	option = {		
		name = galatian_invasion.11.a
		
		add_to_war = {
			target = scope:first_galatian_war_scope
			leader = no 
			attacker = no
		}
		
	}
	
	option = {		
		name = galatian_invasion.11.b
		
	}

}

galatian_invasion.12 = { # Hellenic Notification of Invasion
	type = country_event
	title = "galatian_invasion.12.t"
	desc = "galatian_invasion.12.desc"
	
	left_portrait = scope:pella_attacker.current_ruler
	right_portrait = scope:pella_defender.current_ruler
	
	trigger = {
		country_culture_group = hellenic
		NOT = {	owns = 379 }
		NOT = { tag = TRE }
	}
	
	# immediate = {

	# }	
	
	option = {
		name = galatian_invasion.12.a
	}

}

galatian_invasion.20 = { # Second Wave
	type = country_event
	title = "galatian_invasion.20.t"
	desc = "galatian_invasion.20.desc"
	
	left_portrait = scope:delphi_attacker.current_ruler
	right_portrait = scope:delphi_defender.current_ruler
	goto_location = root
	
	trigger = {
		owns = 424
	}
	
	immediate = { #  invade
	
		random_country = {
			limit = {
				any_owned_province = { province_id = 424 }
			}
			save_scope_as = delphi_defender
		}
		if = {
			limit = {
				scope:delphi_defender = {
					NOT = { owns = 475 }
				}
			}
			random_country = {
				limit = {
					any_owned_province = { province_id = 475 }
				}
				save_scope_as = passerby_one
			}
		}
		if = {
			limit = {
				NOR = {
					scope:delphi_defender = { owns = 399 }
					trigger_if = {
						limit = {exists = scope:passerby_one }
						scope:passerby_one = { owns = 399 }
					}
				}
			}
			random_country = {
				limit = {
					any_owned_province = { province_id = 399 }
				}
				save_scope_as = passerby_two
			}
		}
		
		scope:delphi_attacker = {
			# trigger_if = {
			if = {
				limit = { exists = scope:passerby_one }
				add_military_access = scope:passerby_one
			}
			# trigger_if = {
			if = {
				limit = { exists = scope:passerby_two }
				add_military_access = scope:passerby_two
			}
			declare_war_with_wargoal = {
				war_goal = conquer_wargoal
				province = p:424
				target = scope:delphi_defender
			}
			create_unit = {
				navy = no
				location = p:469 
				while = {
					count = 39
					add_subunit = light_infantry
				}
				while = {
					count = 10
					add_subunit = chariots
				}
			}
			# save_scope_as = second_gauls	
		}
		
		random_current_war = {
			limit = {
				any_war_attacker = { this = scope:delphi_attacker }
				any_war_defender = { this = scope:delphi_defender }
			}
			save_scope_as = second_galatian_war_scope
		}
		
	}
	
	option = {
		name = galatian_invasion.20.a 
		
		random_country = {
			limit = {
				capital_scope = {
					OR = {
						is_in_area = boeotia_area
						is_in_area = central_greece_area
						is_in_area = aetolia_area
					}
				}
				is_subject = no
				NOT = { owns = 424 }
			}
			trigger_event = {
				id = galatian_invasion.21
				days = 1
			}
		}
	}
	
	after = {
		
		every_country = {
			limit = {
				capital_scope = {
					OR = {
						is_in_area = boeotia_area
						is_in_area = central_greece_area
						is_in_area = aetolia_area
					}
				}
			}
			trigger_event = {
				id = galatian_invasion.21
				days = 1
			}
		}
		every_country = {
			limit = {
				country_culture_group = hellenic
			}
			trigger_event = {
				id = galatian_invasion.22
				days = 3
			}
		}
	}
	
}

galatian_invasion.21 = { # Help from Greeks
	type = country_event
	title = "galatian_invasion.21.t"
	desc = "galatian_invasion.21.desc"
	
	left_portrait = scope:delphi_attacker.current_ruler
	right_portrait = scope:delphi_defender.current_ruler
	right_portrait = current_ruler
	goto_location = root
	
	trigger = {
		is_subject = no
		NOT = { owns = 424 }
		NOT = { war_with = scope:delphi_attacker }
	}
	
	immediate = {
		
		# random_country = {
			# limit = { this = root }
			# save_scope_as = friend_of_delphi
		# }
	}	
	
	option = {
		name = galatian_invasion.21.a
		
		# scope:friend_of_delphi = {
		# every_country = {
			# limit = { 
				# capital_scope = {
					# OR = {
						# is_in_area = boeotia_area
						# is_in_area = central_greece_area
						# is_in_area = aetolia_area
					# }
				# }
				# is_subject = no
				# NOT = { owns = 424 }
			# }
			
			add_to_war = {
				target = scope:second_galatian_war_scope
				leader = no 
				attacker = no
			}
			set_variable = {
				name = defender_of_delphi
				value = 1
			}
		# }
	}
	
}

galatian_invasion.22 = { # Hellenic Notification of Invasion
	type = country_event
	title = "galatian_invasion.22.t"
	desc = "galatian_invasion.22.desc"
	
	left_portrait = scope:delphi_attacker.current_ruler
	right_portrait = scope:delphi_defender.current_ruler
	
	trigger = {
		country_culture_group = hellenic
		NOT = {	has_variable = defender_of_delphi }
	}
	
	# immediate = {

	# }	
	
	option = {
		name = galatian_invasion.22.a
	}

}

galatian_invasion.30 = { # Third Wave
	type = country_event
	title = "galatian_invasion.30.t"
	desc = "galatian_invasion.30.desc"
	
	left_portrait = scope:phrygia_attacker.current_ruler
	right_portrait = scope:phrygia_defender.current_ruler
	goto_location = root
	
	trigger = {
		owns = 189
	}
	
	immediate = { #  invade
	
		random_country = {
			limit = {
				any_owned_province = { province_id = 189 }
			}
			save_scope_as = phrygia_defender
		}
		
		scope:phrygia_attacker = {
			# add_military_access = 
			declare_war_with_wargoal = {
				war_goal = conquer_wargoal
				province = p:189
				target = scope:phrygia_defender
			}
			create_unit = {
				navy = no
				location = p:189 
				while = {
					count = 79
					add_subunit = light_infantry
				}
				while = {
					count = 20
					add_subunit = chariots
				}
				# save_scope_as = third_gauls
			}
			
		}
		
	}
	
	option = {
		name = galatian_invasion.30.a 
		
		trigger_event = {
			id = galatian_invasion.34
			days = 100
		}
	}

	after = {
		every_country = {
			limit = {
				country_culture_group = hellenic
			}
			trigger_event = {
				id = galatian_invasion.32
				days = 3
			}
		}
	}

	# option = {
		# name = galatian_invasion.32.b 
	# }
	
}


galatian_invasion.32 = { # Hellenic Notification of Invasion
	type = country_event
	title = "galatian_invasion.32.t"
	desc = "galatian_invasion.32.desc"
	
	left_portrait = scope:phrygia_attacker.current_ruler
	right_portrait = scope:phrygia_defender.current_ruler
	
	trigger = {
		country_culture_group = hellenic
		NOT = {	owns = 189 }
	}
	
	# immediate = {

	# }	
	
	option = {
		name = galatian_invasion.32.a
	}

}

galatian_invasion.34 = { # Special Peace
	type = country_event
	title = "galatian_invasion.34.t"
	desc = "galatian_invasion.34.desc"
	
	left_portrait = scope:phrygia_attacker.current_ruler
	right_portrait = scope:phrygia_defender.current_ruler
	
	trigger = {
		with_with = scope:phrygia_attacker
	}
	
	# immediate = {

	# }	
	
	option = { # Give land and make subject
		name = galatian_invasion.34.a
		
		scope:phrygia_defender = {
			every_owned_province = {
				limit = { is_in_area = galatia_area }
				set_owned_by = scope:phrygia_attacker
			}
			make_subject = {
				target = scope:phrygia_attacker
				type = vassal_tribe
			}
		}
		
		scope:phrygia_attacker = {
			trigger_event = {
				id = galatian_invasion.35 # Move Pops
				days = 1
			}
			
			trigger_event = {
				id = galatian_invasion.38 # Form Galatia
				days = 10
			}
			# make_subject
		}
		# ai_will_do = yes
	}
	
	option = {
		name = galatian_invasion.34.b
		trigger = {
			is_ai = no
		}
	}

}

galatian_invasion.35 = { # Setting Galatia - Start Task
	type = country_event
	title = "galatian_invasion.35.t"
	desc = "galatian_invasion.35.desc"
	
	right_portrait = current_ruler
	
	trigger = {
		country_culture_group = gallic
		any_owned_province = {
			is_in_region = galatia_region
		}
		is_ai = yes
		NOT = { exists = c:GLT }
	}
	
	immediate = {
		
		if = {
			limit = {
				NOT = { exists = c:GLT }
			}
			random_country = {
				limit = {
					country_culture_group = gallic
					any_owned_province = {
						is_in_region = galatia_region
					}
				}
				save_scope_as = first_galatians
			}
		}
				
		if = {
			limit = {
				any_country = {
					country_culture_group = gallic
					any_owned_province = {
						is_in_region = galatia_region
					}
					NOR = {
						tag = GLT
						this = scope:first_galatians
					}
				}
			}
			random_country = {
				limit = {
					country_culture_group = gallic
					any_owned_province = {
						is_in_region = galatia_region
					}
					NOR = {
						tag = GLT
						this = scope:first_galatians
					}				
				}
				save_scope_as = other_galatians
			}
		}
	}
	
	option = {
		name = galatian_invasion.35.a
		
		while = {
			count = { 15 20 }
			if = {
				limit = {
					NOR = { has_variable = galatian_chosen_city }
					# any_ownable_province = {
						# trigger_if = {
							# limit = {
								# exists = owner
							# }
							# NOT = { owner = scope:seleukid_nation }
						# }
					any_owned_province = {
						# total_population >= 20
						OR = {
							is_in_region = macedonia_region
							is_in_region = moesia_region
							is_in_region = illyria_region
							is_in_region = pannonia_region
						}
						province_dominant_culture_group = gallic
					}
				}
				# random_ownable_province = {
				random_owned_province = {
					limit = {
						NOT = { has_variable = galatian_chosen_city }
						# trigger_if = {
							# limit = {
								# exists = owner
							# }
							# NOT = { owner = scope:seleukid_nation }
						# }
						total_population >= 20
						OR = {
							is_in_region = macedonia_region
							is_in_region = moesia_region
							is_in_region = illyria_region
							is_in_region = pannonia_region
						}
						province_dominant_culture_group = gallic
					}
					set_variable = galatian_chosen_city
				
					trigger_event = {
						id = galatian_invasion.37
						days = 3 
					}
				}
			}
		}
	}
	
}

galatian_invasion.36 = { # Settling Galatia - Finish Task; (not necessary)
	type = country_event
	title = "galatian_invasion.36.t"
	desc = "galatian_invasion.36.desc"
	
	immediate = {
		
	}
	
	option = {
		name = galatian_invasion.36.a
		
	}
	
}

galatian_invasion.37 = { # Settling Galatia - Finding Settlers
    type = province_event
    hidden = yes
	# title = "galatian_invasion.37.t"
	# desc = "galatian_invasion.37.desc"
	
	# left_portrait = scope:first_galatians.current_ruler
	# right_portrait = scope:other_galatians.current_ruler
	
	trigger = {

	}
	
	immediate = {
		
	}
	
	option = {
		name = galatian_invasion.37.a
		
		scope:first_galatians = {
			random_owned_province = {
				limit = {
					is_in_area = decapolis_area
					is_in_region = galatia_region
				}
				weight = {
					modifier = {
						factor = 15
						total_population < 15
					}
					modifier = {
						factor = 15
						total_population < 10
					}
					modifier = {
						factor = 5
						is_capital = yes
					}
					modifier = {
						factor = 5
						is_state_capital = yes
					}
					modifier = {
						factor = 3
						total_population < population_cap
					}
					modifier = {
						factor = 0.005
						total_population > population_cap
					}
				}
				save_scope_as = galatian_city
			}
		}
		while = {
			count = { 5 10 }
			if = {
				limit = {
					total_population >= 20
					any_pops_in_province = {
						pop_culture_group = gallic
						# NOR = {
							# pop_type = slaves
							# pop_type = tribesmen
						# }
					}
				}
				random_pops_in_province = {
					limit = {
						pop_culture_group = gallic
						# NOR = {
							# pop_type = slaves
							# pop_type = tribesmen
						# }
					}
					move_pop = scope:galatian_city
				}
				if = {
					limit = {
						has_variable = galatian_pop_move_variable
					}
					change_variable = {
						name = galatian_pop_move_variable
						add = 1
					}
				}
				else = {
					set_variable = {
						name = galatian_pop_move_variable
						value = 1
					}
				}
				scope:galatian_city = {
					if = {
						limit = {
							has_variable = galatian_pop_move_variable
						}
						change_variable = {
							name = galatian_pop_move_variable
							add = 1
						}
					}
					else = {
						set_variable = {
							name = galatian_pop_move_variable
							value = 1
						}
					}
				}
			}
		}
		if = {
			limit = {
				has_variable = galatian_chosen_city
			}
			remove_variable = galatian_chosen_city
		}
		
				# every_owned_province = {
					# every_pops_in_province = {
						# limit = {
							# pop_culture_group = gallic
						# }
						# move_pop = p:189 #scope:capital_scope
					# }
				# }
			# }
			
			# trigger_if = {
				# limit = { exists = scope: other_galatians }
				# scope:other_galatians = {
					# every_owned_province = {
						# every_pops_in_province = {
							# limit = {
								# pop_culture_group = gallic
							# }
							# move_pop = p:189 #scope:capital_scope
						# }
					# }
				# }
			# }	
	}
	# option = {
		
	# }
}

galatian_invasion.38 = { # Forming Galatia
	type = country_event
	title = "galatian_invasion.38.t"
	desc = "galatian_invasion.38.desc"
	
	left_portrait = scope:first_galatians.current_ruler
	right_portrait = scope:other_galatians.current_ruler
	
	trigger = {
		country_culture_group = gallic
		any_owned_province = {
			is_in_region = galatia_region
		}
		is_ai = yes
	}
	
	immediate = {
		
		if = {
			limit = {
				NOT = { exists = c:GLT }
			}
			random_country = {
				limit = {
					country_culture_group = gallic
					any_owned_province = {
						is_in_region = galatia_region
					}
				}
				save_scope_as = first_galatians
			# c:TBL = {
			# effect = {
				# custom_tooltip = "tier_2_formable_tooltip"
				tribal_formable_government_change_effect = yes
				change_country_name = "GALATIA_NAME"
				# hidden_effect = {
					change_country_adjective = "GALATIA_ADJECTIVE"
					change_country_color = "galatia_light_blue_color"
					change_country_tag = GLT
					change_country_flag = GALATIA_FLAG
				# }
				if = {
					limit = {
						p:194 = { is_capital = no }
					}
					set_capital = 194
					hidden_effect = {
						p:194.state = {
							set_state_capital = 194
						}
					}
					capital_scope = {
						establish_city_effect = yes
					}
				}
				p:194 = {
					capital_formable_medium_effect = yes
					formable_capital_modifier_normal_effect = yes
				}
				custom_tooltip = galatia_claims_tooltip
				hidden_effect = {
					region:galatia_region = { formable_region_province_effect = yes }
					region:cappadocia_region = { formable_region_province_effect = yes }
				}
				add_3_free_province_investments = yes
			}
			
		}
		
		if = {
			limit = {
				any_country = {
					country_culture_group = gallic
					any_owned_province = {
						is_in_region = galatia_region
					}
					NOT = { tag = GLT }
				}
			}
			random_country = {
				limit = {
					country_culture_group = gallic
					any_owned_province = {
						is_in_region = galatia_region
					}
					NOT = { tag = GLT }
				}
				save_scope_as = other_galatians
			}
				
			scope:other_galatians = {
				every_owned_province = {
					# limit = { is_in_area = galatia_area }
					set_owned_by = scope:first_galatians
				}
			}
		}
		
	}
	
	option = {
		name = galatian_invasion.37.a
	} 
}
	

galatian_invasion.100 = {
	hidden = yes
	
	immediate = {
			
		c:PRY = {
			every_owned_province = {
				limit = { is_in_area = galatia_area }
				set_owned_by = c:SCD
			}
		}
		
		c:PRY = {
			every_owned_province = {
				limit = { is_in_area = phrygia_epiktetos }
				set_owned_by = c:OTN
			}
		}
	}
}

galatian_invasion.101 = {
	hidden = yes
	
	immediate = {
		
		c:SEL = {
			p:225 = {
				set_owned_by = c:SCD
			}
		}
		
	}
}