namespace = cultural_revolt_inv

cultural_revolt_inv.1 = { #looking for cultures ready to revolt
	type = country_event
	immediate = {
		every_country_culture = {
			limit = {
				is_integrated = no
                NOT = {
                    has_country_culture_modifier = revolting_culture
                }
			}
			save_scope_as = target_revolted_culture
            
			random_list = {
				600 = {}
				2000 = {
					modifier = {
                        factor = 5
                        scope:target_revolted_culture = {
                            country_culture_pop_count >= 40
                        }
                    }
					modifier = {
                        factor = 2
                        scope:target_revolted_culture = {
                            country_culture_pop_count >= 150
                        }
                    }
					modifier = {
                        factor = 2
                        scope:target_revolted_culture = {
                            country_culture_pop_count >= 500
                        }
                    }
					modifier = {
                        factor = 0.5
                        scope:target_revolted_culture = {
                            OR = {
                                has_country_culture_modifier = administrators_cultmodifier
                                has_culture_group = root.culture.culture_group
                            }
                            
                        }
                    }
					modifier = {
                        factor = 0.8
                        scope:target_revolted_culture = {
                            has_country_culture_modifier = inheritance_right
                        }
                    }
					modifier = {
                        factor = 0.8
                        scope:target_revolted_culture = {
                            has_country_culture_modifier = torture_protection
                        }
                    }
					modifier = {
                        factor = 1.5
                        scope:target_revolted_culture = {
                            has_country_culture_modifier = dissatisfied_culture
                        }
                    }
					modifier = {
                        factor = 0.8
                        scope:target_revolted_culture = {
                            OR = {
                                has_country_culture_modifier = right_of_marriage
                            }
                            
                        }
                    }
					modifier = {
                        factor = 1.4
                        scope:target_revolted_culture = {
                            OR = {
                                has_country_culture_modifier = colonia_founded
                                has_country_culture_modifier = despised_annexed_culture
                            }
                            
                        }
                    }
					modifier = {
                        factor = 1.2
                        scope:target_revolted_culture = {
                            OR = {
                                has_country_culture_modifier = slave_rights_imposed
                                has_country_culture_modifier = rights_revoked
                            }
                            
                        }
                    }
					modifier = {
                        factor = 1.2
                        scope:target_revolted_culture = {
                            has_country_culture_modifier = annexed_culture_unhappy
                        }
                    }
					modifier = {
                        factor = 0.8
                        scope:target_revolted_culture = {
                            OR = {
                                has_country_culture_modifier = protected_customs 
                                has_country_culture_modifier = appeased_protests
                            }
                            
                        }
                    }
					modifier = {
                        factor = 0.7
                        scope:target_revolted_culture = {
                            has_country_culture_modifier = respected_annexed_culture
                        }
                    }
					modifier = {
                        factor = 1.2
                        scope:target_revolted_culture = {
                            stability < 40
                        }
                    }
					modifier = {
                        factor = 1.3
                        scope:target_revolted_culture = {
                            stability < 30
                        }
                    }
					modifier = {
                        factor = 1.4
                        scope:target_revolted_culture = {
                            stability < 20
                        }
                    }
					modifier = {
                        factor = 2
                        scope:target_revolted_culture = {
                            stability < 10
                        }
                    }
                        if = {
                            limit = { 
                                root = {
                                 any_owned_province = {
                                    dominant_province_culture = scope:target_revolted_culture.culture
                                }}
                            }
                            root = {
                                trigger_event = { 
                                    id = cultural_revolt_inv.2
                                    days = {1 10}
                                }
                                
                            }
                        }
                    
				}
			}
		}
	}

}

cultural_revolt_inv.2 = { # the first revolt - small
    type = country_event
    title = "cultural_revolt_event.2.t"
    desc = "cultural_revolt_event.2.desc" 
    picture = proscription
    goto_location = scope:random_province_revolted_cult
    left_portrait = scope:revolted_prov_gov 


    immediate = {
        if = { #check if competent governor or ruler
            limit = { 
                any_governorships = {
                    governor_or_ruler = {
                        NOT = { has_culture = scope:target_revolted_culture.culture }
                        OR = {
                            charisma  >= 10
                            has_trait = prominent 
                            has_trait = silver_tongued 
                            has_trait = wise
                        }
                    }
                    any_governorship_state = {
                        any_state_province = {
                            dominant_province_culture = scope:target_revolted_culture.culture	
                        }
                    }
                }
            }
            
            random_governorships = {
                limit = {
                
                    governor_or_ruler = {
                        NOT = { has_culture = scope:target_revolted_culture.culture }
                        OR = {
                            charisma >= 10
                            has_trait = prominent 
                            has_trait = silver_tongued 
                            has_trait = wise
                        }
                    }
                    any_governorship_state = {
                        any_state_province = {
                            dominant_province_culture = scope:target_revolted_culture.culture	
                        }
                    }
                }
                governor_or_ruler = { 
                    save_scope_as = revolted_prov_gov
                    random_governor_state = {
                        limit = {
                            any_state_province = {
                                dominant_province_culture = scope:target_revolted_culture.culture	
                            }
                        }
                        random_state_province = {
                            limit = {
                                dominant_province_culture = scope:target_revolted_culture.culture
                            }
                            weight = {
                                modifier = {
                                    add = total_population
                                }
                            }
                            save_scope_as = random_province_revolted_cult
                        }
                    }
                }

            }
        }
        else = { #else, just take the governor of the chosen province
            
			ordered_owned_province = {
				limit = { dominant_province_culture = scope:target_revolted_culture.culture }
				max = 1
				order_by = total_population
				save_scope_as = random_province_revolted_cult
			}
            scope:random_province_revolted_cult = {
                if = {
                    limit = {
                        exists = governor_or_ruler
                    }
                    governor_or_ruler = {
                        save_scope_as = revolted_prov_gov
                    }
                }
                else = {
                    root = {
                        current_ruler = {
                            save_scope_as = revolted_prov_gov
                        }
                    }
                }
                
            
            }

        }
           
    }

    
    option = { #do nothing - get the modifier
        name = cultural_revolt_inv.2.a
        scope:target_revolted_culture = {
            add_country_culture_modifier = {
                name = "dissatisfied_culture"
				duration = 3650
            }
        }
        custom_tooltip = cultural_revolt_inv.2.a.tt1
    }

    option = { #give them rights
        name = cultural_revolt_inv.2.b
        custom_tooltip = cultural_revolt_inv.2.b.tt1
        trigger = {
            scope:revolted_prov_gov = {
                NOT = { has_trait = harsh }
            }
        }
        if = { #check the already existent rights
            limit = {
                scope:target_revolted_culture = {
                    NOT = {
                        has_country_culture_modifier = torture_protection
                    }
                }
            }
            add_stability = -5
			culture_state_loyalty_effect = yes
			scope:target_revolted_culture = {
				add_country_culture_modifier = {
					name = "torture_protection" 
					duration = -1
				}
			}
			add_country_modifier = {
				name = "extended_torture_protection"
				duration = 1095
			}
            if = {
                limit = {
                    is_republic = yes
                }
                if = {
                    limit = {
                        has_party_type = optimates_party
                    }
                    add_party_approval = {
                        party_type = optimates_party
                        VALUE = party_disapproval_small_svalue
                    }
                    add_party_approval = {
                        party_type = boni_party
                        VALUE = party_approval_small_svalue
                    }
                }
                else = {
                    add_party_approval = {
                        party_type = democratic_party
                        VALUE = party_approval_small_svalue
                    }
                    add_party_approval = {
                        party_type = traditionalist_party
                        VALUE = party_disapproval_small_svalue
                    }
                }
            }

        }
        else_if = {
            limit = { 
                scope:target_revolted_culture = {
                    NOT = {
                        has_country_culture_modifier = right_to_enter_contracts
                    }
                }
            }
			add_stability = -5
			culture_state_loyalty_effect = yes
			scope:target_revolted_culture = {
				add_country_culture_modifier = {
					name = "right_to_enter_contracts" 
					duration = -1
				}
			}
			add_country_modifier = {
				name = "extended_contract_rights"
				duration = 1095
			}
			approval_effect = {
				PARTY = optimates_party
				VALUE = party_disapproval_small_svalue
			}
			approval_effect = {
				PARTY = boni_party
				VALUE = party_approval_small_svalue
			}
			approval_effect = {
				PARTY = oligarchic_party
				VALUE = party_disapproval_small_svalue
			}
			approval_effect = {
				PARTY = democratic_party
				VALUE = party_approval_small_svalue
			}
        }
        else_if = {
            limit = { 
                scope:target_revolted_culture = {
                    NOT = {
                        has_country_culture_modifier = inheritance_right
                    }
                }
            }
            add_stability = -5
			culture_state_loyalty_effect = yes
			scope:target_revolted_culture = {
				add_country_culture_modifier = {
					name = "inheritance_right" 
					duration = -1
				}
			}
			add_country_modifier = {
				name = "extended_inheritance_right"
				duration = 1095
			}
            if = {
                limit = {
                    is_republic = yes
                }
                if = {
                    limit = {
                        has_party_type = optimates_party
                    }
                    add_party_approval = {
                        party_type = optimates_party
                        VALUE = party_disapproval_medium_svalue
                    }
                    add_party_approval = {
                        party_type = populares_party
                        VALUE = party_approval_medium_svalue
                    }
                }
                else = {
                    add_party_approval = {
                        party_type = democratic_party
                        VALUE = party_approval_medium_svalue
                    }
                    add_party_approval = {
                        party_type = traditionalist_party
                        VALUE = party_disapproval_medium_svalue
                    }
                }
            }
        }
        else_if = {
            limit = { 
                scope:target_revolted_culture = {
                    NOT = {
                        has_country_culture_modifier = right_to_enter_contracts
                    }
                }
            }
            add_stability = -10
			culture_state_loyalty_effect = yes
			scope:target_revolted_culture = {
				add_country_culture_modifier = {
					name = right_of_marriage
					duration = -1
				}
			}
			add_country_modifier = {
				name = "extended_right_of_marriage"
				duration = 1825
			}
			ordered_owned_province = {
				limit = { dominant_province_culture = scope:target_revolted_culture.culture }
				max = 1
				order_by = total_population
				state = {
					add_state_modifier = {
						name = "intermarriage_spree"
						duration = 1825
					}
				}
			}
			approval_effect = {
				PARTY = populares_party
				VALUE = party_disapproval_small_svalue
			}
			approval_effect = {
				PARTY = boni_party
				VALUE = party_approval_small_svalue
			}
			approval_effect = {
				PARTY = oligarchic_party
				VALUE = party_disapproval_small_svalue
			}
			approval_effect = {
				PARTY = democratic_party
				VALUE = party_approval_small_svalue
			}
        }

        else = { #all rights already taken - give them some hard modifier
			scope:target_revolted_culture = {
				add_country_culture_modifier = {
					name = protected_customs
					duration = 3600
				}
			}
        }
        
        random_list = {
            300 = { #succeeds
                scope:target_revolted_culture = {
                    add_country_culture_modifier = {
                        name = appeased_protests
                        duration = 7300
                    }
                }
                custom_tooltip = cultural_revolt_inv.2.b.tt2
            }
            1 = { #fails
                modifier = {
                    add = scope:target_revolted_culture.country_culture_pop_count
                }
                modifier = {
                    factor = 0.7
                    scope:revolted_prov_gov = {
                            charisma >= 10
                    }
                }
                modifier = {
                    factor = 0.7
                    scope:revolted_prov_gov = {
                            has_trait = silver_tongued
                    }
                }
                modifier = {
                    factor = 0.6
                    scope:revolted_prov_gov = {
                            has_trait = prominent
                    }
                }
                modifier = {
                    factor = 0.8
                    scope:revolted_prov_gov = {
                            has_trait = generous
                    }
                }
                modifier = {
                    factor = 1.2
                    scope:revolted_prov_gov = {
                            has_trait = corrupt
                    }
                }
                custom_tooltip = cultural_revolt_inv.2.b.tt3
                scope:target_revolted_culture = {
                    add_country_culture_modifier = {
                        name = "dissatisfied_culture"
                        duration = 3650
                    }
                }
                trigger_event = {
                    id = cultural_revolt_inv.3
                    days = {1 10}
                }
            }
        }
    }

    option = { #they already have some rights and gov is competent
        name = cultural_revolt_inv.2.c
        trigger = {
            scope:revolted_prov_gov = {
                NOR = { 
                    has_culture = scope:target_revolted_culture.culture
                    has_trait = harsh
                    has_trait = rash
                }
                OR = {
                    finesse >= 10
                    has_trait = silver_tongued 
                    has_trait = stubborn
                    has_trait = just
                }
            }
            scope:target_revolted_culture = {
                OR = {
                    has_country_culture_modifier = right_to_enter_contracts
                    has_country_culture_modifier = inheritance_right
                    has_country_culture_modifier = torture_protection
                    has_country_culture_modifier = right_of_marriage
                }
            }
        }
        highlight = yes
        custom_tooltip = cultural_revolt_inv.2.c.tt1
        random_list = {
            200 = { #suceeds
                custom_tooltip = cultural_revolt_inv.2.c.tt2
            }
            1 = { #fails
                modifier = {
                    add = scope:target_revolted_culture.country_culture_pop_count
                }
                modifier = {
                    factor = 0.7
                    scope:revolted_prov_gov = {
                            finesse >= 10
                    }
                }
                modifier = {
                    factor = 0.7
                    scope:revolted_prov_gov = {
                            has_trait = silver_tongued
                    }
                }
                modifier = {
                    factor = 0.8
                    scope:revolted_prov_gov = {
                            has_trait = stubborn
                    }
                }
                modifier = {
                    factor = 0.6
                    scope:revolted_prov_gov = {
                            has_trait = just
                    }
                }
                modifier = {
                    factor = 1.2
                    scope:revolted_prov_gov = {
                            has_trait = corrupt
                    }
                }
                custom_tooltip = cultural_revolt_inv.2.c.tt3
                scope:target_revolted_culture = {
                    add_country_culture_modifier = {
                        name = "dissatisfied_culture"
                        duration = 3650
                    }
                }
                trigger_event = {
                    id = cultural_revolt_inv.3
                    days = {1 10}
                }
            }
        }

    }
    option = { #hit them with the stick
        name = cultural_revolt_inv.2.d
        custom_tooltip = cultural_revolt_inv.2.d.tt1

		add_manpower = { #10 manpower per pop
			value = 0
			subtract = scope:target_revolted_culture.country_culture_pop_count
			divide = 100
			max = root.manpower
		}

        random_list = {#base 50/50 whatever the pop
            50 = { #suceeds
                custom_tooltip = cultural_revolt_inv.2.d.tt2
            }
            50 = { #fails
                modifier = {
                    factor = 0.7
                    scope:revolted_prov_gov = {
                            martial >= 10
                    }
                }
                modifier = {
                    factor = 0.7
                    scope:revolted_prov_gov = {
                            has_trait = cruel
                    }
                }
                modifier = {
                    factor = 0.8
                    scope:revolted_prov_gov = {
                            has_trait = harsh
                    }
                }
                modifier = {
                    factor = 0.6
                    scope:revolted_prov_gov = {
                            has_trait = disciplined
                    }
                }
                modifier = {
                    factor = 1.2
                    scope:revolted_prov_gov = {
                            has_trait = uncaring
                    }
                }
                custom_tooltip = cultural_revolt_inv.2.d.tt3
                scope:target_revolted_culture = {
                    add_country_culture_modifier = {
                        name = "dissatisfied_culture"
                        duration = 3650
                    }
                }
                trigger_event = {
                    id = cultural_revolt_inv.3
                    days = {1 10}
                }
            }
        }

    }
}

cultural_revolt_inv.3 = { # inform the player that it did not work
    type = country_event
    title = "cultural_revolt_event.3.t"
    desc = "cultural_revolt_event.3.desc" 
    picture = proscription
    goto_location = scope:random_province_revolted_cult
    left_portrait = scope:revolted_prov_gov 

    option = {
        name = cultural_revolt_inv.3.a
        custom_tooltip = cultural_revolt_inv.3.a.tt1
    }

}

